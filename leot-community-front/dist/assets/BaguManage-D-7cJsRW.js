import{d as Ve,u as ke,T as Ce,r as g,b as N,v as Ue,M as xe,E as d,c as p,H as Se,e as le,o as _,g as t,f as v,w as l,K as M,i as b,J as I,m as s,G as h,z as Q,U as he,V as Ne,k as ae,L as ze,x as Ae,P as Be,Q as De,N as E,O as $e,_ as qe}from"./index-fmth1Foz.js";import{u as Re,q as L}from"./bagu-CFlVxt4r.js";import{q as Pe}from"./question-DUAdpd1i.js";import{T as Te}from"./TechHeader-D3cWMTWR.js";import{G as K}from"./GlassCard-B7OKtasV.js";import{I as Fe}from"./ImageUpload-DB4w8pwZ.js";import"./file-B5KGW4IP.js";const Me={class:"tech-page bagu-manage"},Ie={class:"bagu-manage__content"},Qe={class:"manage-header"},Ee={class:"manage-header"},Le={class:"pagination-wrapper"},Ke={class:"manage-header"},je={class:"pagination-wrapper"},Ge=Ve({__name:"BaguManage",setup(He){const j=ke(),C=Re(),{banks:oe,questions:re,loading:G,total:ne}=Ce(C),H=g("banks"),z=g(1),U=g(!1),A=g(null),n=N({title:"",description:"",picture:""}),se=()=>{j.push("/admin/question/add")},ie=o=>{j.push(`/admin/question/edit/${o.id}`)},B=g(!1),D=g(!1),x=g(!1),S=g(null),$=g(),f=N({userName:"",userAccount:""}),c=N({current:1,pageSize:10,total:0}),O=g([]),u=N({id:void 0,userName:"",userAccount:"",userPassword:"",profile:"",userRole:"user"}),ue={userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"用户名长度在 2 到 20 个字符",trigger:"blur"}],userAccount:[{required:!0,message:"请输入账号",trigger:"blur"},{min:3,max:20,message:"账号长度在 3 到 20 个字符",trigger:"blur"}],userPassword:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],userRole:[{required:!0,message:"请选择角色",trigger:"change"}]};Ue(()=>{C.fetchBanks({current:1,pageSize:100}),q(),V()});const q=()=>{C.fetchQuestions({current:z.value,pageSize:10})},V=async()=>{B.value=!0;try{const o={current:c.current,pageSize:c.pageSize,userName:f.userName||void 0,userAccount:f.userAccount||void 0},e=await xe(o);e.data&&(O.value=e.data.records||[],c.total=e.data.total||0)}catch(o){d.error(o.message||"获取用户列表失败")}finally{B.value=!1}},k=()=>{c.current=1,V()},de=()=>{f.userName="",f.userAccount="",k()},pe=()=>{V()},me=()=>{V()},J=o=>{S.value=o||null,o?Object.assign(u,{id:o.id,userName:o.userName,userAccount:o.userAccount,profile:o.profile||"",userRole:o.userRole,userPassword:""}):Object.assign(u,{id:void 0,userName:"",userAccount:"",userPassword:"",profile:"",userRole:"user"}),x.value=!0},ge=async()=>{$.value&&await $.value.validate(async o=>{if(o){D.value=!0;try{if(S.value){const{userPassword:e,...i}=u;await Be(i),d.success("更新成功")}else await De(u),d.success("新增成功");x.value=!1,V()}catch(e){d.error(e.message||"操作失败")}finally{D.value=!1}}})},fe=async o=>{try{await E.confirm(`确定要删除用户 "${o.userName}" 吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),o.id&&(await $e(o.id),d.success("删除成功"),V())}catch(e){e!=="cancel"&&d.error(e.message||"删除失败")}},Y=o=>{A.value=o||null,o?(n.id=o.id,n.title=o.title,n.description=o.description||"",n.picture=o.picture||""):(n.id=void 0,n.title="",n.description="",n.picture=""),U.value=!0},ce=async()=>{if(!n.title){d.warning("请输入题库标题");return}try{A.value?(await L.update(n),d.success("更新成功")):(await L.add(n),d.success("创建成功")),U.value=!1,C.fetchBanks({current:1,pageSize:100})}catch{d.error("操作失败")}},ve=async o=>{try{await E.confirm("确定要删除该题库吗？","提示",{type:"warning"}),await L.delete(o),d.success("删除成功"),C.fetchBanks({current:1,pageSize:100})}catch(e){e!=="cancel"&&d.error("删除失败")}},be=async o=>{try{await E.confirm("确定要删除该题目吗？","提示",{type:"warning"}),await Pe.delete(o),d.success("删除成功"),q()}catch(e){e!=="cancel"&&d.error("删除失败")}},we=o=>{if(!o)return"";const e=new Date(o);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`};return(o,e)=>{const i=p("el-button"),r=p("el-table-column"),R=p("el-table"),P=p("el-tab-pane"),W=p("el-tag"),X=p("el-pagination"),w=p("el-input"),m=p("el-form-item"),T=p("el-form"),ye=p("el-tabs"),Z=p("el-dialog"),ee=p("el-option"),_e=p("el-select"),F=Se("loading");return _(),le("div",Me,[t(Te,{title:"八股文管理",subtitle:"管理题库和题目内容",animated:!1}),v("div",Ie,[t(ye,{modelValue:H.value,"onUpdate:modelValue":e[7]||(e[7]=a=>H.value=a),class:"manage-tabs"},{default:l(()=>[t(P,{label:"题库管理",name:"banks"},{default:l(()=>[t(K,{padding:"24px"},{default:l(()=>[v("div",Qe,[e[21]||(e[21]=v("h3",null,"题库列表",-1)),t(i,{type:"primary",icon:b(I),onClick:e[0]||(e[0]=a=>Y())},{default:l(()=>[...e[20]||(e[20]=[s(" 新增题库 ",-1)])]),_:1},8,["icon"])]),M((_(),h(R,{data:b(oe),style:{width:"100%"}},{default:l(()=>[t(r,{prop:"id",label:"ID",width:"80"}),t(r,{prop:"title",label:"标题","min-width":"150"}),t(r,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),t(r,{prop:"questionCount",label:"题目数",width:"100"}),t(r,{prop:"createTime",label:"创建时间",width:"180"},{default:l(({row:a})=>[s(Q(we(a.createTime)),1)]),_:1}),t(r,{label:"操作",width:"150",fixed:"right"},{default:l(({row:a})=>[t(i,{type:"primary",link:"",onClick:y=>Y(a)},{default:l(()=>[...e[22]||(e[22]=[s("编辑",-1)])]),_:1},8,["onClick"]),t(i,{type:"danger",link:"",onClick:y=>ve(a.id)},{default:l(()=>[...e[23]||(e[23]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,b(G)]])]),_:1})]),_:1}),t(P,{label:"题目管理",name:"questions"},{default:l(()=>[t(K,{padding:"24px"},{default:l(()=>[v("div",Ee,[e[25]||(e[25]=v("h3",null,"题目列表",-1)),t(i,{type:"primary",icon:b(I),onClick:se},{default:l(()=>[...e[24]||(e[24]=[s(" 新增题目 ",-1)])]),_:1},8,["icon"])]),M((_(),h(R,{data:b(re),style:{width:"100%"}},{default:l(()=>[t(r,{prop:"id",label:"ID",width:"80"}),t(r,{prop:"title",label:"标题","min-width":"200","show-overflow-tooltip":""}),t(r,{prop:"tags",label:"标签",width:"200"},{default:l(({row:a})=>{var y;return[(_(!0),le(he,null,Ne((y=a.tags)==null?void 0:y.slice(0,3),te=>(_(),h(W,{key:te,size:"small",class:"tag-item"},{default:l(()=>[s(Q(te),1)]),_:2},1024))),128))]}),_:1}),t(r,{prop:"viewNum",label:"浏览",width:"80"}),t(r,{prop:"thumbNum",label:"点赞",width:"80"}),t(r,{prop:"favourNum",label:"收藏",width:"80"}),t(r,{label:"操作",width:"150",fixed:"right"},{default:l(({row:a})=>[t(i,{type:"primary",link:"",onClick:y=>ie(a)},{default:l(()=>[...e[26]||(e[26]=[s("编辑",-1)])]),_:1},8,["onClick"]),t(i,{type:"danger",link:"",onClick:y=>be(a.id)},{default:l(()=>[...e[27]||(e[27]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,b(G)]]),v("div",Le,[t(X,{"current-page":z.value,"onUpdate:currentPage":e[1]||(e[1]=a=>z.value=a),"page-size":10,total:b(ne),layout:"prev, pager, next",onCurrentChange:q},null,8,["current-page","total"])])]),_:1})]),_:1}),t(P,{label:"用户管理",name:"users"},{default:l(()=>[t(K,{padding:"24px"},{default:l(()=>[v("div",Ke,[e[29]||(e[29]=v("h3",null,"用户列表",-1)),t(i,{type:"primary",icon:b(I),onClick:e[2]||(e[2]=a=>J())},{default:l(()=>[...e[28]||(e[28]=[s(" 新增用户 ",-1)])]),_:1},8,["icon"])]),t(T,{inline:!0,model:f,class:"search-form"},{default:l(()=>[t(m,{label:"用户名"},{default:l(()=>[t(w,{modelValue:f.userName,"onUpdate:modelValue":e[3]||(e[3]=a=>f.userName=a),placeholder:"请输入用户名",clearable:"",onClear:k,onKeyup:ae(k,["enter"])},null,8,["modelValue"])]),_:1}),t(m,{label:"账号"},{default:l(()=>[t(w,{modelValue:f.userAccount,"onUpdate:modelValue":e[4]||(e[4]=a=>f.userAccount=a),placeholder:"请输入账号",clearable:"",onClear:k,onKeyup:ae(k,["enter"])},null,8,["modelValue"])]),_:1}),t(m,null,{default:l(()=>[t(i,{type:"primary",icon:b(ze),onClick:k},{default:l(()=>[...e[30]||(e[30]=[s(" 搜索 ",-1)])]),_:1},8,["icon"]),t(i,{onClick:de},{default:l(()=>[...e[31]||(e[31]=[s("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),M((_(),h(R,{data:O.value,style:{width:"100%"}},{default:l(()=>[t(r,{type:"index",label:"序号",width:"60",align:"center"}),t(r,{prop:"id",label:"用户ID",width:"80",align:"center"}),t(r,{prop:"userName",label:"用户名",width:"120"}),t(r,{prop:"userAccount",label:"账号",width:"150"}),t(r,{prop:"profile",label:"简介","show-overflow-tooltip":""}),t(r,{prop:"userRole",label:"角色",width:"100",align:"center"},{default:l(({row:a})=>[t(W,{type:a.userRole==="admin"?"danger":"primary"},{default:l(()=>[s(Q(a.userRole==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"createTime",label:"创建时间",width:"180"}),t(r,{prop:"updateTime",label:"更新时间",width:"180"}),t(r,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(({row:a})=>[t(i,{type:"primary",link:"",onClick:y=>J(a)},{default:l(()=>[...e[32]||(e[32]=[s("编辑",-1)])]),_:1},8,["onClick"]),t(i,{type:"danger",link:"",onClick:y=>fe(a)},{default:l(()=>[...e[33]||(e[33]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,B.value]]),v("div",je,[t(X,{"current-page":c.current,"onUpdate:currentPage":e[5]||(e[5]=a=>c.current=a),"page-size":c.pageSize,"onUpdate:pageSize":e[6]||(e[6]=a=>c.pageSize=a),"page-sizes":[10,20,50,100],total:c.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:pe,onCurrentChange:me},null,8,["current-page","page-size","total"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t(Z,{modelValue:U.value,"onUpdate:modelValue":e[12]||(e[12]=a=>U.value=a),title:A.value?"编辑题库":"新增题库",width:"500px"},{footer:l(()=>[t(i,{onClick:e[11]||(e[11]=a=>U.value=!1)},{default:l(()=>[...e[34]||(e[34]=[s("取消",-1)])]),_:1}),t(i,{type:"primary",onClick:ce},{default:l(()=>[...e[35]||(e[35]=[s("保存",-1)])]),_:1})]),default:l(()=>[t(T,{model:n,"label-width":"80px"},{default:l(()=>[t(m,{label:"标题",required:""},{default:l(()=>[t(w,{modelValue:n.title,"onUpdate:modelValue":e[8]||(e[8]=a=>n.title=a),placeholder:"请输入题库标题"},null,8,["modelValue"])]),_:1}),t(m,{label:"描述"},{default:l(()=>[t(w,{modelValue:n.description,"onUpdate:modelValue":e[9]||(e[9]=a=>n.description=a),type:"textarea",rows:3,placeholder:"请输入题库描述"},null,8,["modelValue"])]),_:1}),t(m,{label:"封面图"},{default:l(()=>[t(Fe,{modelValue:n.picture,"onUpdate:modelValue":e[10]||(e[10]=a=>n.picture=a),"biz-type":"questionbank"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(Z,{modelValue:x.value,"onUpdate:modelValue":e[19]||(e[19]=a=>x.value=a),title:S.value?"编辑用户":"新增用户",width:"500px"},{footer:l(()=>[t(i,{onClick:e[18]||(e[18]=a=>x.value=!1)},{default:l(()=>[...e[36]||(e[36]=[s("取消",-1)])]),_:1}),t(i,{type:"primary",loading:D.value,onClick:ge},{default:l(()=>[...e[37]||(e[37]=[s(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(T,{ref_key:"userFormRef",ref:$,model:u,rules:ue,"label-width":"80px"},{default:l(()=>[t(m,{label:"用户名",prop:"userName"},{default:l(()=>[t(w,{modelValue:u.userName,"onUpdate:modelValue":e[13]||(e[13]=a=>u.userName=a),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(m,{label:"账号",prop:"userAccount"},{default:l(()=>[t(w,{modelValue:u.userAccount,"onUpdate:modelValue":e[14]||(e[14]=a=>u.userAccount=a),placeholder:"请输入账号",disabled:!!S.value},null,8,["modelValue","disabled"])]),_:1}),S.value?Ae("",!0):(_(),h(m,{key:0,label:"密码",prop:"userPassword"},{default:l(()=>[t(w,{modelValue:u.userPassword,"onUpdate:modelValue":e[15]||(e[15]=a=>u.userPassword=a),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),t(m,{label:"简介",prop:"profile"},{default:l(()=>[t(w,{modelValue:u.profile,"onUpdate:modelValue":e[16]||(e[16]=a=>u.profile=a),type:"textarea",rows:3,placeholder:"请输入简介",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(m,{label:"角色",prop:"userRole"},{default:l(()=>[t(_e,{modelValue:u.userRole,"onUpdate:modelValue":e[17]||(e[17]=a=>u.userRole=a),placeholder:"请选择角色",style:{width:"100%"}},{default:l(()=>[t(ee,{label:"普通用户",value:"user"}),t(ee,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),tt=qe(Ge,[["__scopeId","data-v-b24316dd"]]);export{tt as default};
