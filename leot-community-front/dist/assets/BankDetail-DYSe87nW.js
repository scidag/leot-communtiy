import{d as j,Y as H,u as K,a as O,T as W,r as c,v as ee,c as C,e as u,o as n,f as s,g as o,G as V,x as g,i as t,I as te,w as d,S as ae,Z as se,m as p,z as x,A as T,$ as oe,J as ne,U,V as $,E as z,X as le,_ as ie}from"./index-fmth1Foz.js";import{u as ue,q as de}from"./bagu-CFlVxt4r.js";import{G as re}from"./GlassCard-B7OKtasV.js";import{Q as ce}from"./QuestionCard-C4fR_9VW.js";import{I as pe}from"./ImageUpload-DB4w8pwZ.js";import"./question-DUAdpd1i.js";import"./file-B5KGW4IP.js";const _e={class:"tech-page bank-detail"},ve={class:"bank-detail__header"},me={class:"bank-detail__cover"},ge=["src","alt"],ke={key:1,class:"bank-detail__placeholder"},fe={class:"bank-detail__meta"},ye={class:"gradient-text"},be={key:0},he={class:"bank-detail__stats"},Ce={class:"stat-item"},xe={class:"stat-item"},Se={key:0,class:"bank-detail__actions"},we={class:"bank-detail__content"},Be={key:0,class:"question-list"},Ve={key:1,class:"empty-state"},ze={key:2,class:"question-list"},qe={key:3,class:"bank-detail__pagination"},De={class:"edit-cover-dialog"},Ie=j({__name:"BankDetail",setup(Te){const A=H(),k=K(),_=ue(),f=O(),{currentBank:i,questions:q,loading:E,total:D}=W(_),y=c(1),S=c(10),b=c(null),v=c(!1),r=c(""),w=c(!1),F=()=>{k.push(`/admin/question/add?bankId=${B}`)},B=Number(A.params.id);ee(()=>{_.fetchBankDetail(B),I()});const I=()=>{_.fetchQuestions({current:y.value,pageSize:S.value,questionBankId:B})},N=a=>{y.value=a,b.value=null,I()},Q=a=>{b.value=b.value===a?null:a},G=a=>{if(!f.token){k.push("/login");return}_.toggleThumb(a)},M=a=>{if(!f.token){k.push("/login");return}_.toggleFavour(a)},P=()=>{k.push("/bagu")},R=a=>{if(!a)return"";const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},Y=a=>{r.value=a},J=async()=>{if(!(!r.value||!i.value)){w.value=!0;try{const a=await de.update({id:i.value.id,picture:r.value});a.code===0?(z.success("封面修改成功"),i.value.picture=r.value,v.value=!1,r.value=""):z.error(a.message||"修改失败")}catch(a){z.error(a.message||"修改失败")}finally{w.value=!1}}};return(a,e)=>{const m=C("el-button"),h=C("el-icon"),L=C("el-pagination"),X=C("el-dialog");return n(),u("div",_e,[s("div",ve,[o(m,{class:"bank-detail__back",icon:t(te),circle:"",onClick:P},null,8,["icon"]),t(i)?(n(),V(re,{key:0,class:"bank-detail__info",glow:!0},{default:d(()=>[s("div",me,[t(i).picture?(n(),u("img",{key:0,src:t(i).picture,alt:t(i).title},null,8,ge)):(n(),u("div",ke,[o(h,{size:64},{default:d(()=>[o(t(ae))]),_:1})])),t(f).isAdmin()?(n(),V(m,{key:2,class:"bank-detail__edit-cover",type:"primary",size:"small",icon:t(se),onClick:e[0]||(e[0]=l=>v.value=!0)},{default:d(()=>[...e[5]||(e[5]=[p(" 修改封面 ",-1)])]),_:1},8,["icon"])):g("",!0)]),s("div",fe,[s("h1",ye,x(t(i).title),1),t(i).description?(n(),u("p",be,x(t(i).description),1)):g("",!0),s("div",he,[s("span",Ce,[o(h,null,{default:d(()=>[o(t(T))]),_:1}),p(" "+x(t(i).questionCount||0)+" 题 ",1)]),s("span",xe,[o(h,null,{default:d(()=>[o(t(oe))]),_:1}),p(" "+x(R(t(i).createTime)),1)])])]),t(f).isAdmin()?(n(),u("div",Se,[o(m,{type:"primary",icon:t(ne),onClick:F},{default:d(()=>[...e[6]||(e[6]=[p(" 添加题目 ",-1)])]),_:1},8,["icon"])])):g("",!0)]),_:1})):g("",!0)]),s("div",we,[e[9]||(e[9]=s("h2",{class:"bank-detail__section-title"},[s("span",{class:"gradient-text"},"题目列表")],-1)),t(E)?(n(),u("div",Be,[(n(),u(U,null,$(5,l=>s("div",{key:l,class:"skeleton-question"},[...e[7]||(e[7]=[s("div",{class:"skeleton",style:{height:"24px",width:"70%","margin-bottom":"12px"}},null,-1),s("div",{class:"skeleton",style:{height:"20px",width:"40%","margin-bottom":"16px"}},null,-1),s("div",{class:"skeleton",style:{height:"20px",width:"30%"}},null,-1)])])),64))])):t(q).length===0?(n(),u("div",Ve,[o(h,{size:64},{default:d(()=>[o(t(T))]),_:1}),e[8]||(e[8]=s("p",null,"该题库暂无题目",-1))])):(n(),u("div",ze,[(n(!0),u(U,null,$(t(q),(l,Z)=>(n(),V(ce,{key:l.id,question:l,expanded:b.value===l.id,class:"animate-fade-in-up",style:le({animationDelay:`${Z*.05}s`}),onClick:Q,onThumb:G,onFavour:M},null,8,["question","expanded","style"]))),128))])),t(D)>S.value?(n(),u("div",qe,[o(L,{"current-page":y.value,"onUpdate:currentPage":e[1]||(e[1]=l=>y.value=l),"page-size":S.value,total:t(D),layout:"prev, pager, next",background:"",onCurrentChange:N},null,8,["current-page","page-size","total"])])):g("",!0)]),o(X,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=l=>v.value=l),title:"修改题库封面",width:"400px","close-on-click-modal":!1},{footer:d(()=>[o(m,{onClick:e[3]||(e[3]=l=>v.value=!1)},{default:d(()=>[...e[10]||(e[10]=[p("取消",-1)])]),_:1}),o(m,{type:"primary",loading:w.value,disabled:!r.value,onClick:J},{default:d(()=>[...e[11]||(e[11]=[p(" 保存 ",-1)])]),_:1},8,["loading","disabled"])]),default:d(()=>[s("div",De,[o(pe,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=l=>r.value=l),"biz-type":"questionbank",onSuccess:Y},null,8,["modelValue"])])]),_:1},8,["modelValue"])])}}}),Ge=ie(Ie,[["__scopeId","data-v-23622cd9"]]);export{Ge as default};
