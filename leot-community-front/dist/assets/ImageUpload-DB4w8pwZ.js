import{d as M,r as h,c as B,e as u,o as p,f as i,x as S,U as E,g as o,h as w,w as g,i as m,a6 as j,a7 as F,J as N,a8 as R,a1 as T,z as U,E as c,_ as q}from"./index-fmth1Foz.js";import{u as D}from"./file-B5KGW4IP.js";const J={class:"image-upload"},$=["src"],A={class:"image-upload__overlay"},G={key:1,class:"image-upload__placeholder"},H={key:2,class:"image-upload__loading"},K=["accept"],L={class:"image-upload__tip"},O=M({__name:"ImageUpload",props:{modelValue:{default:""},bizType:{default:"questionbank"},maxSize:{default:5},accept:{default:"image/jpeg,image/png,image/gif,image/webp"}},emits:["update:modelValue","success","error"],setup(n,{emit:z}){const _=n,r=z,f=h(null),d=h(!1),k=["image/jpeg","image/png","image/gif","image/webp"],v={40001:"请选择要上传的文件",40002:"仅支持 jpg、png、gif、webp 格式的图片",40003:"图片大小不能超过 5MB",50001:"上传失败，请稍后重试",50002:"文件服务暂不可用"},y=()=>{var l;d.value||(l=f.value)==null||l.click()},x=async l=>{var t;const s=l.target,e=(t=s.files)==null?void 0:t[0];if(!e)return;if(s.value="",!k.includes(e.type)){c.error("仅支持 jpg、png、gif、webp 格式的图片");return}const a=_.maxSize*1024*1024;if(e.size>a){c.error(`图片大小不能超过 ${_.maxSize}MB`);return}await C(e)},C=async l=>{var s,e;d.value=!0;try{const a=await D(l,_.bizType);if(a.code===0&&a.data)r("update:modelValue",a.data),r("success",a.data),c.success("上传成功");else{const t=v[a.code]||a.message||"上传失败";c.error(t),r("error",new Error(t))}}catch(a){const t=(e=(s=a.response)==null?void 0:s.data)==null?void 0:e.code,I=v[t]||a.message||"上传失败";c.error(I),r("error",a)}finally{d.value=!1}},b=()=>{r("update:modelValue","")},V=()=>{};return(l,s)=>{const e=B("el-icon");return p(),u("div",J,[i("div",{class:T(["image-upload__preview",{"image-upload__preview--empty":!n.modelValue}]),onClick:y},[n.modelValue?(p(),u(E,{key:0},[i("img",{src:n.modelValue,alt:"预览图片",class:"image-upload__image",onError:V},null,40,$),i("div",A,[o(e,{class:"image-upload__icon",onClick:w(y,["stop"])},{default:g(()=>[o(m(j))]),_:1}),o(e,{class:"image-upload__icon image-upload__icon--delete",onClick:w(b,["stop"])},{default:g(()=>[o(m(F))]),_:1})])],64)):(p(),u("div",G,[o(e,{class:"image-upload__placeholder-icon",size:32},{default:g(()=>[o(m(N))]),_:1}),s[0]||(s[0]=i("span",{class:"image-upload__placeholder-text"},"点击上传图片",-1))])),d.value?(p(),u("div",H,[o(e,{class:"is-loading",size:32},{default:g(()=>[o(m(R))]),_:1}),s[1]||(s[1]=i("span",null,"上传中...",-1))])):S("",!0)],2),i("input",{ref_key:"fileInputRef",ref:f,type:"file",accept:n.accept,class:"image-upload__input",onChange:x},null,40,K),i("div",L," 支持 jpg、png、gif、webp 格式，大小不超过 "+U(n.maxSize)+"MB ",1)])}}}),W=q(O,[["__scopeId","data-v-3eb5cb24"]]);export{W as I};
