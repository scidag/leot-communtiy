import{d as C,u as P,a as R,r as h,b as U,c as i,e as g,o as v,f as l,g as t,w as r,h as z,i as w,j as B,l as E,k as F,m as L,n as S,p as T,E as c,_ as $}from"./index-fmth1Foz.js";const q={class:"login-container"},K={class:"login-wrapper"},M={class:"card-header"},j={class:"logo-wrapper"},I={class:"input-wrapper"},A={class:"input-wrapper"},D={key:0},G={key:1},H={class:"register-link"},J=C({__name:"Login",setup(O){const b=P(),p=R(),m=h(),d=h(!1),n=U({userName:"",userPassword:""}),k={userName:[{required:!0,message:"请输入账号",trigger:"blur"},{min:3,max:20,message:"账号长度在 3 到 20 个字符",trigger:"blur"}],userPassword:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},f=async()=>{m.value&&await m.value.validate(async _=>{var s;if(_){d.value=!0;try{const a=await T(n);if(console.log(n),a.data){const e=a.data.satoken||"";if(!e){c.error("登录失败：未获取到有效凭证");return}p.setToken(e),p.setUser(a.data),await p.initUser(),c.success("登录成功"),a.data.userRole==="admin"?(c.info("管理员登录成功，5秒后跳转到首页"),setTimeout(()=>{b.push("/bagu")},5e3)):b.push("/bagu")}}catch(a){console.log(a);const e=(s=a==null?void 0:a.response)==null?void 0:s.data;let o="登录失败";e?typeof e=="string"?o=e:e.description?o=e.description:e.message?o=e.message:e.error?o=e.error:e.data&&e.data.description?o=e.data.description:e.data&&e.data.message?o=e.data.message:e.status&&e.error&&(o=e.error||`服务器错误 ${e.status}`):a!=null&&a.message&&(o=a.message),c.error(o)}finally{d.value=!1}}})};return(_,s)=>{const a=i("el-icon"),e=i("el-input"),o=i("el-form-item"),y=i("el-button"),V=i("el-link"),N=i("el-form"),x=i("el-card");return v(),g("div",q,[s[7]||(s[7]=l("div",{class:"background-animation"},[l("div",{class:"shape shape-1"}),l("div",{class:"shape shape-2"}),l("div",{class:"shape shape-3"})],-1)),l("div",K,[t(x,{class:"login-card",shadow:"hover"},{header:r(()=>[l("div",M,[l("div",j,[t(a,{size:40,class:"logo-icon"},{default:r(()=>[t(w(S))]),_:1})]),s[3]||(s[3]=l("h2",{class:"title"},"欢迎回来",-1)),s[4]||(s[4]=l("p",{class:"subtitle"},"请登录您的账号",-1))])]),default:r(()=>[t(N,{ref_key:"loginFormRef",ref:m,model:n,rules:k,"label-width":"0",class:"login-form",onSubmit:z(f,["prevent"])},{default:r(()=>[t(o,{prop:"userName"},{default:r(()=>[l("div",I,[t(a,{class:"input-icon"},{default:r(()=>[t(w(B))]),_:1}),t(e,{modelValue:n.userName,"onUpdate:modelValue":s[0]||(s[0]=u=>n.userName=u),placeholder:"请输入账号",clearable:"",size:"large",class:"custom-input"},null,8,["modelValue"])])]),_:1}),t(o,{prop:"userPassword"},{default:r(()=>[l("div",A,[t(a,{class:"input-icon"},{default:r(()=>[t(w(E))]),_:1}),t(e,{modelValue:n.userPassword,"onUpdate:modelValue":s[1]||(s[1]=u=>n.userPassword=u),type:"password",placeholder:"请输入密码","show-password":"",clearable:"",size:"large",class:"custom-input",onKeyup:F(f,["enter"])},null,8,["modelValue"])])]),_:1}),t(o,null,{default:r(()=>[t(y,{type:"primary",loading:d.value,onClick:f,class:"login-button",size:"large"},{default:r(()=>[d.value?(v(),g("span",G,"登录中...")):(v(),g("span",D,"登录"))]),_:1},8,["loading"])]),_:1}),t(o,null,{default:r(()=>[l("div",H,[s[6]||(s[6]=l("span",{class:"link-text"},"还没有账号？",-1)),t(V,{type:"primary",class:"link-button",onClick:s[2]||(s[2]=u=>_.$router.push("/register"))},{default:r(()=>[...s[5]||(s[5]=[L(" 立即注册 ",-1)])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})])])}}}),W=$(J,[["__scopeId","data-v-32e26b80"]]);export{W as default};
