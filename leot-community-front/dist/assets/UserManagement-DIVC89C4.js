import{d as te,u as oe,r as c,b as U,v as re,c as r,H as se,G as k,o as A,w as a,g as l,f as h,m as i,i as R,I as ne,J as ue,K as de,k as B,L as ie,z as me,x as pe,M as ce,E as b,N as fe,O as ge,P as _e,Q as ve,_ as be}from"./index-fmth1Foz.js";const ye={class:"header-left"},we={class:"header-right"},Ve={class:"pagination-container"},he=te({__name:"UserManagement",setup(Ce){const F=oe(),C=c(!1),x=c(!1),f=c(!1),y=c(!1),N=c("新增用户"),V=c(),n=U({userName:"",userAccount:""}),u=U({current:1,pageSize:10,total:0}),z=c([]),s=U({id:void 0,userName:"",userAccount:"",userPassword:"",profile:"",userRole:"user"}),M={userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"用户名长度在 2 到 20 个字符",trigger:"blur"}],userAccount:[{required:!0,message:"请输入账号",trigger:"blur"},{min:3,max:20,message:"账号长度在 3 到 20 个字符",trigger:"blur"}],userPassword:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],userRole:[{required:!0,message:"请选择角色",trigger:"change"}]},g=async()=>{C.value=!0;try{const o={current:u.current,pageSize:u.pageSize,userName:n.userName||void 0,userAccount:n.userAccount||void 0},e=await ce(o);e.data&&(z.value=e.data.records||[],u.total=e.data.total||0)}catch(o){b.error(o.message||"获取用户列表失败")}finally{C.value=!1}},_=()=>{u.current=1,g()},T=()=>{n.userName="",n.userAccount="",_()},E=()=>{g()},q=()=>{g()},I=()=>{y.value=!1,N.value="新增用户",S(),f.value=!0},K=o=>{y.value=!0,N.value="编辑用户",Object.assign(s,{id:o.id,userName:o.userName,userAccount:o.userAccount,profile:o.profile||"",userRole:o.userRole,userPassword:""}),f.value=!0},L=async o=>{try{await fe.confirm(`确定要删除用户 "${o.userName}" 吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),o.id&&(await ge(o.id),b.success("删除成功"),g())}catch(e){e!=="cancel"&&b.error(e.message||"删除失败")}},$=async()=>{V.value&&await V.value.validate(async o=>{if(o){x.value=!0;try{if(y.value){const{userPassword:e,...w}=s;await _e(w),b.success("更新成功")}else await ve(s),b.success("新增成功");f.value=!1,g()}catch(e){b.error(e.message||"操作失败")}finally{x.value=!1}}})},S=()=>{var o;Object.assign(s,{id:void 0,userName:"",userAccount:"",userPassword:"",profile:"",userRole:"user"}),(o=V.value)==null||o.clearValidate()},j=()=>{S()},O=()=>{F.push("/dashboard")};return re(()=>{g()}),(o,e)=>{const w=r("el-icon"),m=r("el-button"),G=r("el-header"),v=r("el-input"),p=r("el-form-item"),P=r("el-form"),d=r("el-table-column"),H=r("el-tag"),J=r("el-table"),Q=r("el-pagination"),W=r("el-card"),X=r("el-main"),D=r("el-option"),Y=r("el-select"),Z=r("el-dialog"),ee=r("el-container"),le=se("loading");return A(),k(ee,{class:"admin-container"},{default:a(()=>[l(G,{class:"admin-header"},{default:a(()=>[h("div",ye,[l(m,{type:"text",onClick:O,style:{color:"white","margin-right":"20px"}},{default:a(()=>[l(w,null,{default:a(()=>[l(R(ne))]),_:1}),e[11]||(e[11]=i(" 返回 ",-1))]),_:1}),e[12]||(e[12]=h("h2",null,"用户管理",-1))]),h("div",we,[l(m,{type:"primary",onClick:I},{default:a(()=>[l(w,null,{default:a(()=>[l(R(ue))]),_:1}),e[13]||(e[13]=i(" 新增用户 ",-1))]),_:1})])]),_:1}),l(X,{class:"admin-main"},{default:a(()=>[l(W,null,{default:a(()=>[l(P,{inline:!0,model:n,class:"search-form"},{default:a(()=>[l(p,{label:"用户名"},{default:a(()=>[l(v,{modelValue:n.userName,"onUpdate:modelValue":e[0]||(e[0]=t=>n.userName=t),placeholder:"请输入用户名",clearable:"",onClear:_,onKeyup:B(_,["enter"])},null,8,["modelValue"])]),_:1}),l(p,{label:"账号"},{default:a(()=>[l(v,{modelValue:n.userAccount,"onUpdate:modelValue":e[1]||(e[1]=t=>n.userAccount=t),placeholder:"请输入账号",clearable:"",onClear:_,onKeyup:B(_,["enter"])},null,8,["modelValue"])]),_:1}),l(p,null,{default:a(()=>[l(m,{type:"primary",onClick:_},{default:a(()=>[l(w,null,{default:a(()=>[l(R(ie))]),_:1}),e[14]||(e[14]=i(" 搜索 ",-1))]),_:1}),l(m,{onClick:T},{default:a(()=>[...e[15]||(e[15]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),de((A(),k(J,{data:z.value,border:"",style:{width:"100%"}},{default:a(()=>[l(d,{type:"index",label:"序号",width:"60",align:"center"}),l(d,{prop:"id",label:"用户ID",width:"80",align:"center"}),l(d,{prop:"userName",label:"用户名",width:"120"}),l(d,{prop:"userAccount",label:"账号",width:"150"}),l(d,{prop:"profile",label:"简介","show-overflow-tooltip":""}),l(d,{prop:"userRole",label:"角色",width:"100",align:"center"},{default:a(({row:t})=>[l(H,{type:t.userRole==="admin"?"danger":"primary"},{default:a(()=>[i(me(t.userRole==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),l(d,{prop:"createTime",label:"创建时间",width:"180"}),l(d,{prop:"updateTime",label:"更新时间",width:"180"}),l(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:a(({row:t})=>[l(m,{type:"primary",size:"small",onClick:ae=>K(t)},{default:a(()=>[...e[16]||(e[16]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(m,{type:"danger",size:"small",onClick:ae=>L(t)},{default:a(()=>[...e[17]||(e[17]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,C.value]]),h("div",Ve,[l(Q,{"current-page":u.current,"onUpdate:currentPage":e[2]||(e[2]=t=>u.current=t),"page-size":u.pageSize,"onUpdate:pageSize":e[3]||(e[3]=t=>u.pageSize=t),"page-sizes":[10,20,50,100],total:u.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:E,onCurrentChange:q},null,8,["current-page","page-size","total"])])]),_:1})]),_:1}),l(Z,{modelValue:f.value,"onUpdate:modelValue":e[10]||(e[10]=t=>f.value=t),title:N.value,width:"500px",onClose:j},{footer:a(()=>[l(m,{onClick:e[9]||(e[9]=t=>f.value=!1)},{default:a(()=>[...e[18]||(e[18]=[i("取消",-1)])]),_:1}),l(m,{type:"primary",loading:x.value,onClick:$},{default:a(()=>[...e[19]||(e[19]=[i(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(P,{ref_key:"userFormRef",ref:V,model:s,rules:M,"label-width":"80px"},{default:a(()=>[l(p,{label:"用户名",prop:"userName"},{default:a(()=>[l(v,{modelValue:s.userName,"onUpdate:modelValue":e[4]||(e[4]=t=>s.userName=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(p,{label:"账号",prop:"userAccount"},{default:a(()=>[l(v,{modelValue:s.userAccount,"onUpdate:modelValue":e[5]||(e[5]=t=>s.userAccount=t),placeholder:"请输入账号",disabled:y.value},null,8,["modelValue","disabled"])]),_:1}),y.value?pe("",!0):(A(),k(p,{key:0,label:"密码",prop:"userPassword"},{default:a(()=>[l(v,{modelValue:s.userPassword,"onUpdate:modelValue":e[6]||(e[6]=t=>s.userPassword=t),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),l(p,{label:"简介",prop:"profile"},{default:a(()=>[l(v,{modelValue:s.profile,"onUpdate:modelValue":e[7]||(e[7]=t=>s.profile=t),type:"textarea",rows:3,placeholder:"请输入简介",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(p,{label:"角色",prop:"userRole"},{default:a(()=>[l(Y,{modelValue:s.userRole,"onUpdate:modelValue":e[8]||(e[8]=t=>s.userRole=t),placeholder:"请选择角色",style:{width:"100%"}},{default:a(()=>[l(D,{label:"普通用户",value:"user"}),l(D,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})}}}),Ne=be(he,[["__scopeId","data-v-7b98b4c5"]]);export{Ne as default};
