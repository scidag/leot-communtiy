import{a9 as v,aa as S,a as N,r as n,E as c}from"./index-fmth1Foz.js";import{q as l}from"./question-DUAdpd1i.js";const m={getById:t=>v.get(`/bagu/questionBank/get?id=${t}`),listByPage:t=>v.post("/bagu/questionBank/list/page",t),add:t=>v.post("/bagu/questionBank/add",t),update:t=>v.put("/bagu/questionBank/update",t),delete:t=>v.delete("/bagu/questionBank/delete",{data:{id:t}})},A=S("bagu",()=>{const t=N(),h=n([]),y=n(null),i=n([]),o=n(null),g=n([]),r=n(!1),f=n(0);async function b(e={current:1,pageSize:20}){r.value=!0;try{const a=await m.listByPage(e);a.code===0&&(h.value=a.data.records,f.value=a.data.total)}catch(a){console.error("获取题库列表失败",a)}finally{r.value=!1}}async function B(e){r.value=!0;try{const a=await m.getById(e);a.code===0&&(y.value=a.data)}catch(a){console.error("获取题库详情失败",a)}finally{r.value=!1}}async function k(e){r.value=!0;try{const a=await l.listByPage(e);a.code===0&&(i.value=a.data.records,f.value=a.data.total)}catch(a){console.error("获取题目列表失败",a)}finally{r.value=!1}}async function p(e){r.value=!0;try{const a=await l.search(e);a.code===0&&(i.value=a.data.records,f.value=a.data.total)}catch(a){console.error("搜索题目失败",a)}finally{r.value=!1}}async function w(e){r.value=!0;try{const a=await l.getById(e);a.code===0&&(o.value=a.data)}catch(a){console.error("获取题目详情失败",a)}finally{r.value=!1}}async function F(e){var a;if(!t.token){c.warning("请先登录");return}try{const s=await l.thumb(e);if(s.code===0){const u=i.value.find(d=>d.id===e);u&&(u.hasThumb=!u.hasThumb,u.thumbNum+=u.hasThumb?1:-1),((a=o.value)==null?void 0:a.id)===e&&(o.value.hasThumb=!o.value.hasThumb,o.value.thumbNum+=o.value.hasThumb?1:-1),c.success(s.data?"点赞成功":"取消点赞")}}catch(s){console.error("点赞操作失败",s),c.error("操作失败")}}async function q(e){var a;if(!t.token){c.warning("请先登录");return}try{const s=await l.favour(e);if(s.code===0){const u=i.value.find(d=>d.id===e);u&&(u.hasFavour=!u.hasFavour,u.favourNum+=u.hasFavour?1:-1),((a=o.value)==null?void 0:a.id)===e&&(o.value.hasFavour=!o.value.hasFavour,o.value.favourNum+=o.value.hasFavour?1:-1),c.success(s.data?"收藏成功":"取消收藏")}}catch(s){console.error("收藏操作失败",s),c.error("操作失败")}}async function T(e){if(!t.token){c.warning("请先登录");return}r.value=!0;try{const a=await l.listFavour(e);a.code===0&&(g.value=a.data.records,f.value=a.data.total)}catch(a){console.error("获取收藏列表失败",a)}finally{r.value=!1}}return{banks:h,currentBank:y,questions:i,currentQuestion:o,favourites:g,loading:r,total:f,fetchBanks:b,fetchBankDetail:B,fetchQuestions:k,searchQuestions:p,fetchQuestionDetail:w,toggleThumb:F,toggleFavour:q,fetchFavourites:T}});export{m as q,A as u};
